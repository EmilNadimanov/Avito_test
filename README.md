# Avito_test
В этом репозитории хранится тестовое задание для стажировки в Авито, юнит Авито.Авто;
Код написан на python(3.8.3), в основе лежит веб-фреймворк django(3.1.1).
Использована стандартная библиотека, из нестандартного - собственно Django.
Для запуска сайта требуется ввести команду ```python manage.py runserver``` в корневой папке Avito_test.

Для работы с сервисом можно использовать:
1) Прямые API запросы, например через httpie \
    ```sudo apt-get install httpie```\
    В запросе должна указываться полная ссылка на вебсайт. Валидность ссылки не проверяется, но
    в случае, если отсутствует указание на протокол или префикс 'www.', они добавляются.
    Таким образом, сервис принимает ссылки в форматах ```web.org```| ```http://web.org```  | ```www.web.org``` |  ```http://www.web.org```
    и не падает/не останавливает пользователя, если ввод имеет вид ```beetlejuice://beetlejuice.beetlejuice``` или вроде того.
    
    Поле, для которого запрашивается короткая репрезентация, называется ***full_link***, его значение требуется указать в запросе. \
    Например, в ответ на запрос:
    ```http POST http://127.0.0.1:8000/ full_link=sar.com``` \
    Возвращается JSON-ответ в формате 
    ```
    {
        "created": "2020-09-28T13:37:25.226Z",
        "full_link": "https://www.sar.com/",
        "short_link": "http://127.0.0.1:8000/########"
    }
    ```
    Где '#' - это либо цифра 0-9, либо буква a-zA-Z (62 варианта на каждое место)
    Кодирование короткого представления реализовано размещением из 62 по 8. \
    За этим ответом в одном JSON-массиве, упорядоченные по времени создания (новые-старые),
    следуют все предыдущие сокращённыые представления, чтобы не лезть каждый раз в БД.
    Если всё же хочется, то через команду ```python manage.py shell``` в корневой папке запускаем интерпретатор Python для работы с сервисом,
    вводим (обращайтесь к [документации Django](https://docs.djangoproject.com/en/3.1/topics/db/queries/))
    ```
   In [1]: from avito_test.short_url.models import ShortLink
   In [2]: objs = ShortLink.objects
   In [3]: objs.all() # для вывода всех объектов
   ...
   In [4]: objs.filter(created__year=2020) # для фильтрации объектов
   ...
   In [5]: objs.all().delete() # для удаления вхождений из БД
    ```
2) Другой вариант - воспользоваться UI. При запуске сайта на локальной машине переходим по адресу http://127.0.0.1:8000/
и вводим в поле свою ссылку, после чего нас перенаправляет в архив запросов (поле для ввода сохраняется).
Снизу суровое html-представление выводит историю сокращённых ссылок в том же JSON-формате. Графический интерфейс позволяет
смотреть глазами на текст и искать в истории запросов что-нибудь интересное.


При переходе по сокращённой ссылке считывается короткое представление после '/' и по нему в БД ищется полное представление, по которому и перенаправляется пользователь